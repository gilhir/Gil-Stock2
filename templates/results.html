<!DOCTYPE html>
    <html lang="en">

    
<!-- Mirrored from coderthemes.com/hyper/saas/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 29 Jul 2022 10:18:47 GMT -->
<head>
        <meta charset="utf-8" />
        <title>Stock Analysis</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
        <meta content="Coderthemes" name="author" />
        <!-- App favicon -->
        <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
        <!-- third party css -->
        <link href="{{ url_for('static', filename='css/vendor/jquery-jvectormap-1.2.2.css') }}" rel="stylesheet" type="text/css" />
        <!-- third party css end -->

        <!-- App css -->
        <link href="{{ url_for('static', filename='css/icons.min.css') }}" rel="stylesheet" type="text/css" />
        <link href="{{ url_for('static', filename='css/app.min.css') }}" rel="stylesheet" type="text/css" id="app-style"/>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
            .bg-light-red {
    background-color: #f8d7da;
}

.bg-light-green {
    background-color: #d4edda;
}

.bg-light-orange {
    background-color: #ffeeba;
}

.bg-light-pink {
    background-color: #f8d7da;
}

/* Highlight Styles */
.highlight-green {
    background-color: lightgreen;
    transition: background-color 1s ease;
}

.highlight-red {
    background-color: lightcoral;
    transition: background-color 1s ease;
}

.fade-out {
    transition: background-color 2s ease; /* Smooth transition for fading out */
}

@keyframes fadeOut {
    from { background-color: inherit; }
    to { background-color: transparent; }
}

        </style>
               </style>
               <script>
                   var staticFilePath = "{{ url_for('static', filename='leftsidemenu.html') }}";
                   document.addEventListener('DOMContentLoaded', function() {
                       fetch(staticFilePath)
                           .then(response => response.text())
                           .then(data => {
                               document.getElementById('leftside-menu').innerHTML = data;
                               var currentPath = window.location.pathname;
                               var navLinks = document.querySelectorAll('.side-nav-link');
                               navLinks.forEach(function(link) {
                                   // Get the href attribute of the link
                                   var linkPath = new URL(link.href).pathname;
                                   // Compare the link path with the current path
                                   if (linkPath === currentPath) {
                                       // Add the active class to the link and the parent li element
                                       link.classList.add('active');
                                       link.parentElement.classList.add('menuitem-active');
                                   }
                               });
                           })
                           .catch(error => console.error('Error fetching the menu:', error));
                   });
                   var navbarcustom = "{{ url_for('static', filename='navbar-custom.html') }}";
                   var userId = "{{ user_id }}";
                   imagetochange = "{{ url_for('static', filename='images/tomer.gif') }}";
       
                   document.addEventListener('DOMContentLoaded', function() {
                       fetch(navbarcustom)
                           .then(response => response.text())
                           .then(data => {
                               var navbarElement = document.getElementsByClassName('navbar-custom')[0];
                               navbarElement.innerHTML = data;
       
                               // Inject user data
                               navbarElement.querySelector('.account-user-name').innerText = userId;
       
                               // Set the image source correctly
                               navbarElement.querySelector('.rounded-circletom').src = imagetochange;
                           })
                           .catch(error => console.error('Error fetching the menu:', error));
                   });
       
               </script>
    </head>

    <body class="loading" data-layout-color="light" data-leftbar-theme="dark" data-layout-mode="fluid" data-rightbar-onstart="true">
        <!-- Begin page -->
        <div class="wrapper">
            <!-- ========== Left Sidebar Start ========== -->
            <div id="leftside-menu" class="leftside-menu"></div>

            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->

            <div class="content-page">
                <div class="content">
                    <!-- Topbar Start -->
                    <div class="navbar-custom">
                    </div>
                    <!-- end Topbar -->
                    
                    <!-- Start Content-->
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <h4 class="page-title">My Portfolio</h4>
                                </div>
                            </div>
                        </div>
                        <div id="market-closed-notice" class="alert alert-warning text-center" style="display: none;" class="alert alert-warning alert-dismissible fade show mb-3" role="alert">
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            The market is currently closed. Prices will not be updated until further notice.
                        </div>
                        <!-- end row -->
                        {% set sorted_portfolio = results.portfolio | sort(attribute='action', reverse=true) %}
                        <div class="row">
                                <div class="row">
                                    {% for result in sorted_portfolio %}
                                    <div class="col-md-4 col-sm-6 mb-4">
                                        <div class="card {% if result.action == 'Sell' %} bg-light-red {% endif %}">
                                            <div class="card-body">
                                                <div class="dropdown float-end">
                                                    <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <i class="mdi mdi-dots-horizontal"></i>
                                                    </a>
                                                    <div class="dropdown-menu dropdown-menu-end">
                                                        <!-- item-->
                                                        <a href="javascript:void(0);" class="dropdown-item"><i class="mdi mdi-cached me-1"></i>Refresh</a>
                                                        <!-- item-->
                                                        <a href="javascript:void(0);" class="dropdown-item"><i class="mdi mdi-circle-edit-outline me-1"></i>Edit</a>
                                                        <!-- item-->
                                                        <a href="javascript:void(0);" class="dropdown-item text-danger"><i class="mdi mdi-delete-outline me-1"></i>Remove</a>
                                                    </div>
                                                </div>
                                                <div class="d-flex">
                                                    <div class="flex-shrink-0">
                                                        <div class="avatar-sm rounded">
                                                            <span class="avatar-title bg-primary-lighten h3 my-0 text-primary rounded">
                                                                <i class="mdi mdi-currency-usd"></i>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="flex-grow-1 ms-3">
                                                        <h4 class="mt-0 mb-1 font-20"><a href="{{ result.external_link }}" target="_blank">{{ result.ticker }}</a></h4>
                                                        <p class="mb-0 text-muted"><i id="arrow-{{ result.ticker }}" class="mdi mdi-arrow-up-bold text-success"></i><span id="price-{{ result.ticker }}">{{ result.current_price }}</span></p>
                                                        <p class="card-text">Average Price: {{ result.average_price }}</p>
                                                        <p class="card-text">Percentage Difference: {{ result.percentage_diff }}</p>
                                                        {% if result.trend_status %}
                                                        <p class="card-text">Trend Status: {{ result.trend_status }}</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="row align-items-end justify-content-between mt-3">
                                                        <div class="chart-container" style="height:240px;">
                                                            <canvas id="{{ result.ticker }}Chart"></canvas>
                                                    </div> <!-- end col -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div> <!-- end row -->
                        </div> <!-- end row -->
                    </div>
                    <!-- container -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box">
                                <h4 class="page-title">My Watchlist</h4>
                            </div>
                        </div>
                    </div>
                                            <div class="row">
                                                    <div class="row">
                                                        {% for action in ['Buy', 'Get Ready', 'Next Time', 'Stay Away', 'Non relevant'] %}
                                                        {% for result in results.watch_list if result.action == action %}
                                                        <div class="col-md-4 col-sm-6 mb-4">
                                                            <div class="card 
                                                            {% if result.action == 'Sell' %} bg-light-red 
                                                            {% elif result.action == 'Buy' %} bg-light-green 
                                                            {% elif result.action == 'Get Ready' %} bg-light-orange 
                                                            {% elif result.action == 'Next Time' %} bg-light-pink 
                                                            {% endif %}">
                                                                <div class="card-body">
                                                                    <div class="dropdown float-end">
                                                                        <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">
                                                                            <i class="mdi mdi-dots-horizontal"></i>
                                                                        </a>
                                                                        <div class="dropdown-menu dropdown-menu-end">
                                                                            <!-- item-->
                                                                            <a href="javascript:void(0);" class="dropdown-item"><i class="mdi mdi-cached me-1"></i>Refresh</a>
                                                                            <!-- item-->
                                                                            <a href="javascript:void(0);" class="dropdown-item"><i class="mdi mdi-circle-edit-outline me-1"></i>Edit</a>
                                                                            <!-- item-->
                                                                            <a href="javascript:void(0);" class="dropdown-item text-danger"><i class="mdi mdi-delete-outline me-1"></i>Remove</a>
                                                                        </div>
                                                                    </div>
                                                                    <div class="d-flex">
                                                                        <div class="flex-shrink-0">
                                                                            <div class="avatar-sm rounded">
                                                                                <span class="avatar-title bg-primary-lighten h3 my-0 text-primary rounded">
                                                                                    <i class="mdi mdi-currency-usd"></i>
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="flex-grow-1 ms-3">
                                                                            <h4 class="mt-0 mb-1 font-20"><a href="{{ result.external_link }}" target="_blank">{{ result.ticker }}</a></h4>
                                                                            <p class="mb-0 text-muted"><i id="arrow-{{ result.ticker }}" class="mdi mdi-arrow-up-bold text-success"></i><span id="price-{{ result.ticker }}">{{ result.current_price }}</span></p>
                                                                            <p class="card-text">Average Price: {{ result.average_price }}</p>
                                                                            <p class="card-text">Percentage Difference: {{ result.percentage_diff }}</p>
                                                                            {% if result.trend_status %}
                                                                            <p class="card-text">Trend Status: {{ result.trend_status }}</p>
                                                                            {% endif %}
                                                                        </div>
                                                                    </div>
                                                                    <div class="row align-items-end justify-content-between mt-3">
                                                                            <div class="chart-container" style="height:240px;">
                                                                                <canvas id="{{ result.ticker }}WatchListChart"></canvas>
                                                                        </div> <!-- end col -->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        {% endfor %}
                                                        {% endfor %}
                                                    </div> <!-- end row -->
                                            </div> <!-- end row -->x
            </div>
        </div>
<!-- Right Sidebar -->
<div class="end-bar">

    <div class="rightbar-title">
        <a href="javascript:void(0);" class="end-bar-toggle float-end">
            <i class="dripicons-cross noti-icon"></i>
        </a>
        <h5 class="m-0">Settings</h5>
    </div>

    <div class="rightbar-content h-100" data-simplebar>

        <div class="p-3">
            <div class="alert alert-warning" role="alert">
                <strong>Customize </strong> the overall color scheme, sidebar menu, etc.
            </div>

            <!-- Settings -->
            <h5 class="mt-3">Color Scheme</h5>
            <hr class="mt-1" />

            <div class="form-check form-switch mb-1">
                <input class="form-check-input" type="checkbox" name="color-scheme-mode" value="light" id="light-mode-check" checked>
                <label class="form-check-label" for="light-mode-check">Light Mode</label>
            </div>

            <div class="form-check form-switch mb-1">
                <input class="form-check-input" type="checkbox" name="color-scheme-mode" value="dark" id="dark-mode-check">
                <label class="form-check-label" for="dark-mode-check">Dark Mode</label>
            </div>


            <!-- Width -->
            <h5 class="mt-4">Width</h5>
            <hr class="mt-1" />
            <div class="form-check form-switch mb-1">
                <input class="form-check-input" type="checkbox" name="width" value="fluid" id="fluid-check" checked>
                <label class="form-check-label" for="fluid-check">Fluid</label>
            </div>

            <div class="form-check form-switch mb-1">
                <input class="form-check-input" type="checkbox" name="width" value="boxed" id="boxed-check">
                <label class="form-check-label" for="boxed-check">Boxed</label>
            </div>


            <!-- Left Sidebar-->
            <h5 class="mt-4">Left Sidebar</h5>
            <hr class="mt-1" />
            <div class="form-check form-switch mb-1">
                <input class="form-check-input" type="checkbox" name="theme" value="default" id="default-check">
                <label class="form-check-label" for="default-check">Default</label>
            </div>

            <div class="form-check form-switch mb-1">
                <input class="form-check-input" type="checkbox" name="theme" value="light" id="light-check" checked>
                <label class="form-check-label" for="light-check">Light</label>
            </div>

            <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" name="theme" value="dark" id="dark-check">
                <label class="form-check-label" for="dark-check">Dark</label>
            </div>

            <div class="form-check form-switch mb-1">
                <input class="form-check-input" type="checkbox" name="compact" value="fixed" id="fixed-check" checked>
                <label class="form-check-label" for="fixed-check">Fixed</label>
            </div>

            <div class="form-check form-switch mb-1">
                <input class="form-check-input" type="checkbox" name="compact" value="condensed" id="condensed-check">
                <label class="form-check-label" for="condensed-check">Condensed</label>
            </div>

            <div class="form-check form-switch mb-1">
                <input class="form-check-input" type="checkbox" name="compact" value="scrollable" id="scrollable-check">
                <label class="form-check-label" for="scrollable-check">Scrollable</label>
            </div>

            <div class="d-grid mt-4">
                <button class="btn btn-primary" id="resetBtn">Reset to Default</button>
    
                <a href="https://themes.getbootstrap.com/product/hyper-responsive-admin-dashboard-template/"
                    class="btn btn-danger mt-3" target="_blank"><i class="mdi mdi-basket me-1"></i> Purchase Now</a>
            </div>
        </div> <!-- end padding-->

    </div>
</div>

        <div class="rightbar-overlay"></div>
        <!-- /End-bar -->

        <!-- bundle -->
        <script src="{{ url_for('static', filename='/js/vendor.min.js')}}"></script>
        <script src="{{ url_for('static', filename='/js/app.min.js')}}"></script>

        <!-- third party js -->
        <script src="{{ url_for('static', filename='/js/vendor/jquery-jvectormap-1.2.2.min.js')}}"></script>
        <script src="{{ url_for('static', filename='/js/vendor/jquery-jvectormap-world-mill-en.js')}}"></script>
        <!-- third party js ends -->

        <!-- demo app -->
        <script src="{{ url_for('static', filename='/js/pages/demo.dashboard.js')}}"></script>
        <!-- end demo js-->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                console.log("Script has started");
        
                function updatePriceArrow(ticker, currentPrice, averagePrice) {
                    console.log(`Updating arrow for ticker: ${ticker}`);
        
                    var arrowElement = document.getElementById('arrow-' + ticker);
        
                    if (!arrowElement) {
                        return;
                    }
        
                    if (isNaN(currentPrice)) {
                        return;
                    }
        
                    if (isNaN(averagePrice)) {
                        return;
                    }
        
                    if (currentPrice > averagePrice) {
                        arrowElement.classList.remove('mdi-arrow-down-bold', 'text-danger');
                        arrowElement.classList.add('mdi-arrow-up-bold', 'text-success');
                    } else {
                        arrowElement.classList.remove('mdi-arrow-up-bold', 'text-success');
                        arrowElement.classList.add('mdi-arrow-down-bold', 'text-danger');
                    }
                }
        
                console.log("Iterating through sorted_portfolio");
                {% for result in sorted_portfolio %}
                    var ticker = '{{ result.ticker }}';
                    var priceElement = document.getElementById('price-' + ticker);
                    if (!priceElement) {
                    } else {
                        var rawCurrentPrice = priceElement.innerText;
                        var currentPrice = parseFloat(rawCurrentPrice.replace('$', ''));
                        var rawAveragePrice = '{{ result.average_price }}';
                        var averagePrice = parseFloat(rawAveragePrice.replace('$', ''));
                        updatePriceArrow(ticker, currentPrice, averagePrice);
                    }
                {% endfor %}
        
                console.log("Iterating through watch_list");
                {% for result in results.watch_list %}
                    var ticker = '{{ result.ticker }}';
                    var priceElement = document.getElementById('price-' + ticker);
                    if (!priceElement) {
                    } else {
                        var rawCurrentPrice = priceElement.innerText;
                        var currentPrice = parseFloat(rawCurrentPrice.replace('$', ''));
                        var rawAveragePrice = '{{ result.average_price }}';
                        var averagePrice = parseFloat(rawAveragePrice.replace('$', ''));
                        updatePriceArrow(ticker, currentPrice, averagePrice);
                    }
                {% endfor %}
            });
        </script>
        
        
        
        
        
        <script>
            function openModal(imageSrc) {
                document.getElementById('modalImage').src = imageSrc;
                document.getElementById('myModal').style.display = "block";
            }
    
            function closeModal() {
                document.getElementById('myModal').style.display = "none";
            }
    
            // Close the modal if the user clicks outside of it
            window.onclick = function(event) {
                if (event.target == document.getElementById('myModal')) {
                    closeModal();
                }
            }
    
            // Close alert dynamically
            document.addEventListener("DOMContentLoaded", function () {
                const alertCloseButtons = document.querySelectorAll(".alert .btn-close");
                alertCloseButtons.forEach(button => {
                    button.addEventListener("click", function () {
                        this.closest(".alert").remove();
                    });
                });
    
                // Auto-close alert after a timeout (30 seconds)
                setTimeout(() => {
                    const alert = document.getElementById("alert");
                    if (alert) {
                        alert.style.opacity = "0"; // Fade out
                        setTimeout(() => alert.remove(), 1000); // Remove after fade out
                    }
                }, 30000); // 30 seconds
            });
    
            let marketCheckInterval;
            let marketReopenTimeout;
    
            // Function to fetch the latest stock prices
        async function fetchLatestPrices() {
            try {
                const response = await fetch('/latest_prices');
                const data = await response.json();
                const marketClosedNotice = document.getElementById('market-closed-notice');
                if (data.market_status === 'closed') {
                    marketClosedNotice.style.display = 'block';
                    marketClosedNotice.style.opacity = '1';
                    marketClosedNotice.innerText = `The market is currently closed. Prices will not be updated until ${data.next_open}.`;
                    clearInterval(marketCheckInterval);
                    const nextOpenTime = new Date(data.next_open).getTime();
                    const currentTime = new Date().getTime();
                    const timeUntilOpen = nextOpenTime - currentTime;
                    console.log(`market closed time untill open: ${timeUntilOpen}`);
                    marketReopenTimeout = setTimeout(() => {
                    console.log("Setting interval for market check after reopening.");
                    marketCheckInterval = setInterval(fetchLatestPrices, 7000);
                    fetchLatestPrices();  // Immediate fetch when market opens
                }, timeUntilOpen);
                }else{
                    marketClosedNotice.style.display = 'none';
                    marketClosedNotice.style.opacity = '0';
                    updatePricesAndCharts(data);
                }
            } catch (error) {
                console.error('Error fetching latest prices:', error);
            }
        }
        fetchLatestPrices();
        marketCheckInterval = setInterval(fetchLatestPrices, 7000);
    
        // Function to update prices and charts on the page
        function updatePricesAndCharts(data) {
            Object.keys(data).forEach(ticker => {
                const priceElement = document.getElementById(`price-${ticker}`);
                const currentPrice = parseFloat(priceElement.innerText.replace('$', ''));
                const newPrice = parseFloat(data[ticker].current_price);
    
                if (newPrice.toFixed(2) !== currentPrice.toFixed(2)) {
                    priceElement.innerText = `$${newPrice.toFixed(2)}`;
                    priceElement.classList.add(newPrice > currentPrice ? 'highlight-green' : 'highlight-red');
                    
                    // Use a separate timeout for fade-out
                    setTimeout(() => {
                        priceElement.classList.remove(newPrice > currentPrice ? 'highlight-green' : 'highlight-red');
                        priceElement.classList.add('fade-out');
                    }, 1000);  // Delay before fading out
    
                    setTimeout(() => {
                        priceElement.classList.remove('fade-out');
                    }, 3000);  // Total duration for transition and fade-out
                }
                function findChartByTicker(charts, ticker) {
                    for (let key in charts) {
                        if (key.startsWith(`${ticker}`))
                        {
                        return charts[key]; 
                        }
                    }
                    return null;
                }
                const chart = findChartByTicker(charts, ticker);
                if (chart) {
                    const labels = chart.data.labels;
                    const data = chart.data.datasets[0].data;
                    const today = new Date().toISOString().split('T')[0];
                    const dateIndex = labels.indexOf(today);
    
                    if (dateIndex !== -1) {
                        data[dateIndex] = newPrice.toFixed(2);
                    } else {
                        labels.push(today);
                        data.push(newPrice.toFixed(2));
                    }
    
                    chart.update();
                }   
            });
        }
    
    
            // Store existing chart instances
            const charts = {};
    
            function createChart(chartId, labels, closePrices, movingAverages) {
                const ctx = document.getElementById(chartId).getContext('2d');
    
                // Destroy existing chart if it exists
                if (charts[chartId]) {
                    charts[chartId].destroy();
                }
    
                const chartData = {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: chartId + ' Close Prices',
                                data: closePrices,
                                borderColor: 'rgba(114,124,245, 1)',
                                backgroundColor: 'rgba(114,124,245, 0.2)',
                                fill: false,
                            },
                            {
                                label: chartId + ' Moving Average',
                                data: movingAverages,
                                borderColor: 'rgba(10,207,151, 1)',
                                backgroundColor: 'rgba(10,207,151, 0.2)',
                                fill: false,
                            }
                        ]
                    },
                    options: {
                        plugins:{
       legend: {
        display: false
       }
      },
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: false }
                        },
                        tooltips: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return tooltipItem.yLabel;
                                }
                            }
                        }
                    }
                };
    
                charts[chartId] = new Chart(ctx, chartData);
            }
    
            // Initialize charts for portfolio and watchlist
            function initializeCharts(results, suffix) {
                results.forEach(result => {
                    createChart(
                        `${result.ticker}${suffix}Chart`,
                        result.dates,
                        result.last_50_closes,
                        result.last_50_ma
                    );
                });
            }
    
            // Call the function for portfolio and watchlist
            initializeCharts({{ results.portfolio | tojson }}, '');
            initializeCharts({{ results.watch_list | tojson }}, 'WatchList');
        </script>
    </body>

<!-- Mirrored from coderthemes.com/hyper/saas/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 29 Jul 2022 10:20:07 GMT -->
</html>